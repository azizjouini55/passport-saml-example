
version: "3.3"

services:
  auth-service:
    #image: azizjouini/passport-app-saml:latest
    build: .
    container_name: node-auth
    pull_policy: always
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.auth-service.rule=Host(`auth-service.localhost`)"
    volumes:
      #replace with real certificates and key paths from your machine 
      - /etc/ssl/certs/ssl-cert-snakeoil.pem:/app/cert/ssl-cert-snakeoil.pem
      - /etc/ssl/private/ssl-cert-snakeoil.key:/app/cert/ssl-cert-snakeoil.key
      - /etc/ssl/aai/dfn-aai.pem:/app/cert/dfn-aai.pem
      - /etc/localtime:/etc/localtime:ro
    depends_on:
      - reverse-proxy
    networks:
     - back
     - front
    ports:
     - "3031:3031"

  py-app:
    build: ./flask-app
    container_name: test-app
    depends_on:
      - auth-service
    expose:
      - "8081"
    networks:
     - back

  reverse-proxy:
    image: traefik:v2.9
    container_name: traefik-router
    command: --api.insecure=true --providers.docker
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    ports: 
      - "8083:80"
      - "8085:8080"
    networks:
    - front

  # prometheus:
  #   image: prom/prometheus:v2.1.0
  #   volumes:
  #     - ./prometheus/:/etc/prometheus/
  #     - prometheus_data:/prometheus
  #   command:
  #     - '--config.file=/etc/prometheus/prometheus.yml'
  #     - '--storage.tsdb.path=/prometheus'
  #     - '--web.console.libraries=/usr/share/prometheus/console_libraries'
  #     - '--web.console.templates=/usr/share/prometheus/consoles'
  #   ports:
  #     - 9090:9090
  #   networks:
  #     - back




networks:
  back:    
    driver: bridge
  front:
    driver: bridge

    

 